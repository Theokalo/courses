<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Scanning με το Plex (μέρος 2ο) &mdash; Compiler Lecture Notes 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Compiler Lecture Notes 1.0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Compiler Lecture Notes 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="scanning-plex-2">
<h1>Scanning με το Plex (μέρος 2ο)<a class="headerlink" href="#scanning-plex-2" title="Permalink to this headline">¶</a></h1>
<div class="section" id="single-line">
<h2>Αγνοώντας single-line σχόλια<a class="headerlink" href="#single-line" title="Permalink to this headline">¶</a></h2>
<p>Το ζητούμενο είναι η κατασκευή scanner που να αναγνωρίζει</p>
<ul class="simple">
<li>identifiers</li>
<li>ακέραιες σταθερές</li>
<li>σταθερές floating point (στις μορφές xx.yy και .yy, σε οποιοδήποτε αριθμό ψηφίων x και y)</li>
<li>σταθερές hex (στη μορφή 0x...)</li>
<li>τα keywords if, the, else, end</li>
<li>τους τελεστές + - * / = &lt; &gt; (τελεστές ενός χαρακτήρα)</li>
</ul>
<p>και να αγνοεί:</p>
<ul class="simple">
<li>newline, tab, space</li>
<li>οτιδήποτε ακολουθεί // μέχρι το τέλος της γραμμής</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A sample app using plex module.</span>
<span class="sd">A simple language token extractor, with single line comment support.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">plex</span>

<span class="c"># define some pattern constructs here, to increase readability</span>
<span class="n">letter</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;AZaz&quot;</span><span class="p">)</span>
<span class="n">digit</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;09&quot;</span><span class="p">)</span>
<span class="n">hexdigit</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">NoCase</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;af09&quot;</span><span class="p">))</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">letter</span> <span class="o">+</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep</span><span class="p">(</span><span class="n">letter</span> <span class="o">|</span> <span class="n">digit</span><span class="p">)</span>
<span class="n">space</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s">&quot; </span><span class="se">\t\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;if&quot;</span><span class="p">,</span><span class="s">&quot;then&quot;</span><span class="p">,</span><span class="s">&quot;else&quot;</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
<span class="n">intnumber</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
<span class="n">floatnumber</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Opt</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">))</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>	<span class="c"># xx.yy, .yy but not xx.</span>
<span class="n">hexnumber</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;0x&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">hexdigit</span><span class="p">)</span>
<span class="n">operator</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s">&quot;+-*/=&lt;&gt;&quot;</span><span class="p">)</span>
<span class="n">singlecomment</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">AnyBut</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

<span class="c"># the scanner lexicon - constructor argument is a list of (pattern,action ) tuples</span>
<span class="n">lexicon</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Lexicon</span><span class="p">([</span>
	<span class="p">(</span><span class="n">intnumber</span><span class="p">,</span><span class="s">&quot;INTCONST&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">floatnumber</span><span class="p">,</span><span class="s">&quot;FLOATCONST&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">hexnumber</span><span class="p">,</span><span class="s">&quot;HEXCONST&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>	
	<span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;IDENTIFIER&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">space</span><span class="o">|</span><span class="n">singlecomment</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>
	<span class="p">])</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;plex6.txt&quot;</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>	

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	
	<span class="k">try</span><span class="p">:</span>
		<span class="n">token</span><span class="p">,</span><span class="n">matched</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
		
	<span class="k">except</span> <span class="n">plex</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">PlexError</span><span class="p">:</span>
		<span class="n">fname</span><span class="p">,</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>	
		<span class="k">print</span><span class="p">(</span><span class="s">&quot;Scanner Error at line {} char {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
		<span class="k">break</span>
	
	<span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span> <span class="k">break</span>

	<span class="k">print</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">matched</span><span class="p">)</span>
			
<span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Εφαρμόζεται στο <a class="reference download internal" href="../_downloads/plex6.txt"><tt class="xref download docutils literal"><span class="pre">plex6.txt</span></tt></a>.</p>
</div>
<div class="section" id="multiple-line">
<h2>Αγνοώντας multiple-line σχόλια /* ... */<a class="headerlink" href="#multiple-line" title="Permalink to this headline">¶</a></h2>
<p>Αν τα block σχόλια τερματίζονται με έναν μόνο χαρακτήρα, τότε μπορούμε να εφαρμόσουμε μια λύση όπως στο προηγούμενο. Στην περίπτωση που ο τερματισμός των σχολίων απαιτεί μια ακολουθία χαρακτήρων (όπως το <tt class="docutils literal"><span class="pre">*/</span></tt>), είναι πιο εύκολο να χρησιμοποιήσουμε ξεχωριστό state όσο βρισκόμαστε μέσα στο σχόλιο. Εκτός από την απλότητα, το ξεχωριστό state επιτρέπει το χειρισμό nested σχολίων (π.χ. με έναν counter που παρακολουθεί το επίπεδο nesting -δεν υλοποιείται όμως στο επόμενο παράδειγμα) και δεν απαιτεί την αποθήκευση πολλών χαρακτήρων από τον scanner μέχρι το τέλος του σχολίου:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A sample app using plex module.</span>
<span class="sd">A simple language token extractor, with single line comment support</span>
<span class="sd">and block comment support (via scanner states).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">plex</span>

<span class="c"># define some pattern constructs here, to increase readability</span>
<span class="n">letter</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;AZaz&quot;</span><span class="p">)</span>
<span class="n">digit</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;09&quot;</span><span class="p">)</span>
<span class="n">hexdigit</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">NoCase</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s">&quot;af09&quot;</span><span class="p">))</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">letter</span> <span class="o">+</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep</span><span class="p">(</span><span class="n">letter</span> <span class="o">|</span> <span class="n">digit</span><span class="p">)</span>
<span class="n">space</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s">&quot; </span><span class="se">\t\n</span><span class="s">&quot;</span><span class="p">)</span>
<span class="n">keyword</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;if&quot;</span><span class="p">,</span><span class="s">&quot;then&quot;</span><span class="p">,</span><span class="s">&quot;else&quot;</span><span class="p">,</span><span class="s">&quot;end&quot;</span><span class="p">)</span>
<span class="n">intnumber</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
<span class="n">floatnumber</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Opt</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">))</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>	<span class="c"># xx.yy, .yy but not xx.</span>
<span class="n">hexnumber</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;0x&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">hexdigit</span><span class="p">)</span>
<span class="n">operator</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s">&quot;+-*/=&lt;&gt;&quot;</span><span class="p">)</span>
<span class="n">singlecomment</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">plex</span><span class="o">.</span><span class="n">Rep</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">AnyBut</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

<span class="c"># the scanner lexicon - constructor argument is a list of (pattern,action ) tuples</span>
<span class="n">lexicon</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Lexicon</span><span class="p">([</span>
	<span class="p">(</span><span class="n">intnumber</span><span class="p">,</span><span class="s">&quot;INTCONST&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">floatnumber</span><span class="p">,</span><span class="s">&quot;FLOATCONST&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">hexnumber</span><span class="p">,</span><span class="s">&quot;HEXCONST&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>	
	<span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;IDENTIFIER&quot;</span><span class="p">),</span>
	<span class="p">(</span><span class="n">space</span><span class="o">|</span><span class="n">singlecomment</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">),</span>
	<span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;/*&quot;</span><span class="p">),</span><span class="n">plex</span><span class="o">.</span><span class="n">Begin</span><span class="p">(</span><span class="s">&#39;BlockCommentState&#39;</span><span class="p">)),</span>	<span class="c"># switch to block comment state</span>
	
	<span class="n">plex</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="s">&#39;BlockCommentState&#39;</span><span class="p">,[</span>
	  <span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s">&quot;*/&quot;</span><span class="p">),</span><span class="n">plex</span><span class="o">.</span><span class="n">Begin</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)),</span>	<span class="c"># back to normal state</span>
	  <span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">AnyChar</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>		<span class="c"># this works due to the longest match rule</span>
	<span class="p">])</span>
	  
	<span class="p">])</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;plex7.txt&quot;</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>	

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
	
	<span class="k">try</span><span class="p">:</span>
		<span class="n">token</span><span class="p">,</span><span class="n">matched</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
		
	<span class="k">except</span> <span class="n">plex</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">PlexError</span><span class="p">:</span>
		<span class="n">fname</span><span class="p">,</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>	
		<span class="k">print</span><span class="p">(</span><span class="s">&quot;Scanner Error at line {} char {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
		<span class="k">break</span>
	
	<span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span> <span class="k">break</span>

	<span class="k">print</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">matched</span><span class="p">)</span>
			
<span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Εφαρμόζεται στο <a class="reference download internal" href="../_downloads/plex7.txt"><tt class="xref download docutils literal"><span class="pre">plex7.txt</span></tt></a>.</p>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Compiler Lecture Notes 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, mistral.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>